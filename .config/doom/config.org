#+title: Doom Emacs Config
#+author: Masood Ahmed
#+startup: overview
#+property: header-args:emacs-lisp :tangle yes :comments none :results none

* Overview
This file is the source of truth for my Doom Emacs configuration.

It is written as literate Org: prose lives in Org headings, and Emacs Lisp lives only inside source blocks.
Doom’s =:config literate= module tangles this file into =$DOOMDIR/config.el= when I run =doom sync= (and optionally on save, depending on module settings).

Guiding principles:
- Keep code blocks free of comments so tangled output stays clean.
- Prefer Doom conventions (=use-package!=, =after!=, =map!=) so my settings aren’t overwritten by module defaults.
- Keep “early” variables early (e.g., identity, theme, fonts, directories).

Make this file run slightly faster (see [[https://nullprogram.com/blog/2016/12/22/][this blog post]]).
#+begin_src emacs-lisp
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src

* Table of Contents :toc:
- [[#overview][Overview]]
- [[#startup-prerequisites][Startup prerequisites]]
  - [[#environment-variables][Environment variables]]
  - [[#identity][Identity]]
- [[#editing-defaults][Editing defaults]]
  - [[#language-aware-soft-wrapping][Language-aware soft wrapping]]
- [[#projects][Projects]]
- [[#org-mode][Org mode]]
  - [[#org-paths][Org paths]]
  - [[#task-management][Task management]]
  - [[#capture-templates][Capture templates]]
  - [[#agenda-views][Agenda views]]
  - [[#usage][Usage]]
  - [[#tables-and-todo-highlighting][Tables and TODO highlighting]]
- [[#look-and-feel][Look and feel]]
  - [[#font][Font]]
  - [[#theme][Theme]]
  - [[#line-numbers][Line numbers]]
  - [[#org-heading-typography][Org heading typography]]
- [[#ai-and-developer-integrations][AI and developer integrations]]
  - [[#gptel--magit][GPTel + Magit]]
- [[#apps][Apps]]
  - [[#slack-for-work][Slack (For work)]]
  - [[#alert-for-work][Alert (For work)]]
- [[#exit-behavior][Exit behavior]]

* Startup prerequisites
** Environment variables
Load machine specific envvars file.

*** Work Machine
#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (doom-load-envvars-file "~/.config/doom/pantheon.envvar"))
#+end_src

** Identity
Used by templates, snippets, GPG/email tooling, and some package defaults. I default to my personal email, with a per-machine override for my work laptop.

*** Personal Machines.
#+begin_src emacs-lisp
(setq user-full-name "Masood Ahmed"
      user-mail-address "me@ahmedmasood.com")
#+end_src

*** Work Machine.
On my work laptop, set the correct email.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (setq user-mail-address "masoodahmed@pantheon.io"))
#+end_src

* Editing defaults
** Language-aware soft wrapping
Global “smart” wrapping is useful for prose and code comments while keeping indentation reasonable.

#+begin_src emacs-lisp
(+global-word-wrap-mode t)
#+end_src

* Projects
Projectile is my project indexer. I keep my working directories under =~/code=.

#+begin_src emacs-lisp
(setq projectile-project-search-path '("~/code/"))
#+end_src

* Org mode
** Org paths
Org file paths are defined early so capture targets never evaluate to nil.

#+begin_src emacs-lisp
(setq org-directory (expand-file-name "~/org/")
      org-inbox-file (expand-file-name "inbox.org" org-directory)
      org-projects-file (expand-file-name "projects.org" org-directory)
      org-tickler-file (expand-file-name "tickler.org" org-directory))
#+end_src

** Task management
This section defines where tasks live, how I capture them quickly, and how I review them.

I use a simple workflow:
- Capture everything into an inbox quickly.
- Triage inbox items into projects.
- Use Agenda to drive the day/week.

*** Files
These are the core Org files used by capture and agenda.

#+begin_src emacs-lisp
(after! org
  (setq org-default-notes-file org-inbox-file
        org-agenda-files (list org-inbox-file
                               org-projects-file
                               org-tickler-file)))
#+end_src

*** TODO states
I keep a small state machine: TODO → NEXT → DONE, with WAIT/CANCELLED when needed.

#+begin_src emacs-lisp
(after! org
  (setq org-todo-keywords
        '((sequence "TODO(t)" "NEXT(n)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELLED(c@)"))))
#+end_src

*** Refile targets
Refiling is how I move tasks from my inbox into the right project heading.
I keep it shallow and fast (up to level 3 in projects).

#+begin_src emacs-lisp
(after! org
  (setq org-refile-use-outline-path 'file
        org-outline-path-complete-in-steps nil
        org-refile-targets
        `((,org-projects-file :maxlevel . 3)
          (,org-inbox-file :maxlevel . 2))))
#+end_src

** Capture templates
Capture is my primary entry point for tasks and notes. I trigger capture with Doom’s capture command (commonly =SPC X=) and pick a template key.

I override Doom’s default =t= template so it captures a real TODO into my inbox.

#+begin_src emacs-lisp
(after! org
  (setq org-capture-templates
        `(
          ("t" "Todo (inbox)" entry
           (file ,org-inbox-file)
           "* TODO %^{Task} :inbox:\n%U\n%a\n"
           :empty-lines 1)

          ("T" "Todo (tagged)" entry
           (file ,org-inbox-file)
           "* TODO %^{Task} :inbox:%^{tag|work|personal|homelab}:\n%U\n%a\n"
           :empty-lines 1)

          ("m" "Meeting" entry
           (file+headline ,org-projects-file "Meetings")
           "* %^{Title} %U\n** Notes\n%?\n** Actions\n"
           :empty-lines 1)

          ("s" "Scheduled" entry
           (file ,org-tickler-file)
           "* TODO %?\nSCHEDULED: %^t\n%U\n%a\n"
           :empty-lines 1)

          ("p" "Templates for projects")
          ("pt" "Project-local todo" entry
           (file+headline +org-capture-project-todo-file "Inbox")
           "* TODO %?\n%i\n%a"
           :prepend t)
          ("pn" "Project-local notes" entry
           (file+headline +org-capture-project-notes-file "Inbox")
           "* %U %?\n%i\n%a"
           :prepend t)
          ("pc" "Project-local changelog" entry
           (file+headline +org-capture-project-changelog-file "Unreleased")
           "* %U %?\n%i\n%a"
           :prepend t)

          ("o" "Centralized templates for projects")
          ("ot" "Project todo" entry #'+org-capture-central-project-todo-file
           "* TODO %?\n %i\n %a"
           :heading "Tasks"
           :prepend nil)
          ("on" "Project notes" entry #'+org-capture-central-project-notes-file
           "* %U %?\n %i\n %a"
           :heading "Notes"
           :prepend t)
          ("oc" "Project changelog" entry #'+org-capture-central-project-changelog-file
           "* %U %?\n %i\n %a"
           :heading "Changelog"
           :prepend t))))
#+end_src

** Agenda views
The agenda is my primary way to see what I owe and what I should do next.

Custom views:
- Overview: week agenda + NEXT actions + inbox triage
- Inbox: inbox only
- Homelab: tasks tagged homelab
- Work: tasks tagged work

#+begin_src emacs-lisp
(after! org
  (setq org-agenda-custom-commands
        '(("o" "Overview"
           ((agenda "" ((org-agenda-span 7)
                        (org-deadline-warning-days 7)))
            (todo "NEXT" ((org-agenda-overriding-header "Next actions")))
            (tags-todo "+inbox" ((org-agenda-overriding-header "Inbox (triage)")))))
          ("i" "Inbox (triage)"
           ((tags-todo "+inbox")))
          ("h" "Homelab"
           ((tags-todo "homelab")))
          ("w" "Work"
           ((tags-todo "work"))))))
#+end_src

** Usage
Common actions:
- Capture a task: =SPC X= then pick =t= / =T= / =m= / =s=
- Open agenda: =SPC o A=
- In agenda, run custom commands: press =o= / =i= / =h= / =w=
- While on a task: schedule with =s=, set deadline with =d=, change state with =t=

** Tables and TODO highlighting
These are quality-of-life preferences for Org buffers.

#+begin_src emacs-lisp
(setq org-modern-table-vertical 1
      org-modern-table t)
#+end_src

TODO Highlighting

#+begin_src emacs-lisp
(add-hook 'org-mode-hook #'hl-todo-mode)
#+end_src

* Look and feel
** Font
The primary font used for the UI and editing. If the font isn’t found, confirm it’s installed and use =M-x describe-font=.

#+begin_src emacs-lisp
(setq doom-font (font-spec :family "MesloLGS Nerd Font" :size 14))
#+end_src

** Theme
Doom themes are set via =doom-theme=. Theme changes are applied on restart or with =M-x doom/reload-theme=.

#+begin_src emacs-lisp
(setq doom-theme 'catppuccin)
#+end_src

** Line numbers
This determines the style of line numbers in effect. If set to =nil=, line numbers are disabled. For relative line numbers, set this to =relative=. Relative line numbers work well with Evil motions.

#+begin_src emacs-lisp
(setq display-line-numbers-type 'relative)
#+end_src

** Org heading typography
I like larger headings in Org buffers for readability. This config is intentionally applied *after* theme load *and* org mode is loaded so it works regardless of which theme is active.

#+begin_src emacs-lisp
(after! org
  (custom-theme-set-faces!
    '(org-level-8 :inherit outline-3 :height 1.0)
    '(org-level-7 :inherit outline-3 :height 1.0)
    '(org-level-6 :inherit outline-3 :height 1.1)
    '(org-level-5 :inherit outline-3 :height 1.2)
    '(org-level-4 :inherit outline-3 :height 1.3)
    '(org-level-3 :inherit outline-3 :height 1.4)
    '(org-level-2 :inherit outline-2 :height 1.5)
    '(org-level-1 :inherit outline-1 :height 1.6)
    '(org-document-title :height 1.8 :bold t :underline nil)))
#+end_src

* AI and developer integrations
** GPTel + Magit
Integrates GPTel with Forge pull request workflows.

*** Magit

#+begin_src emacs-lisp
(use-package! gptel-magit
  :after magit
  :hook (magit-mode . gptel-magit-install))
#+end_src

*** Forge

#+begin_src emacs-lisp
(use-package! gptel-forge-prs
  :after forge
  :config
  (gptel-forge-prs-install))
#+end_src

* Apps
** Slack (For work)
Slack is only configured on my Pantheon laptop. Credentials are pulled from auth-source entries keyed by host/user.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (use-package! slack
    :config
    (slack-register-team
     :name "pantheon"
     :token (auth-source-pick-first-password
             :host "pantheon.slack.com"
             :user "masoodahmed@pantheon.io^token")
     :enterprise-token (auth-source-pick-first-password
                        :host "pantheon.slack.com"
                        :user "masoodahmed@pantheon.io^enterprise-token")
     :cookie (auth-source-pick-first-password
              :host "pantheon.slack.com"
              :user "masoodahmed@pantheon.io^cookie")
     :full-and-display-names t
     :default t
     :subscribed-channels nil)))
#+end_src

** Alert (For work)
I use alert package for Slack alerts.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))

  (use-package! alert
    :commands (alert)
    :init
    (setq alert-default-style 'notifier)))
#+end_src

* Exit behavior
I prefer to exit without confirmation prompts.

#+begin_src emacs-lisp
(setq confirm-kill-emacs nil)
(setq confirm-kill-processes nil)
#+end_src
