#+title: Doom Emacs Config
#+author: Masood Ahmed
#+startup: overview
#+property: header-args:emacs-lisp :tangle yes :comments none :results none

* Overview
This file is the source of truth for my Doom Emacs configuration.

It is written as literate Org: prose lives in Org headings, and Emacs Lisp lives only inside source blocks.
Doom’s =:config literate= module tangles this file into =$DOOMDIR/config.el= when I run =doom sync= (and optionally on save, depending on module settings).

Guiding principles:
- Keep code blocks free of comments so tangled output stays clean.
- Prefer Doom conventions (=use-package!=, =after!=, =map!=) so my settings aren’t overwritten by module defaults.
- Keep “early” variables early (e.g., identity, theme, fonts, directories).

Make this file run slightly faster (see [[https://nullprogram.com/blog/2016/12/22/][this blog post]]).
#+begin_src emacs-lisp
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src

* Startup prerequisites
** Environment variables
Load machine specific envvars file.

*** Work Machine
#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (doom-load-envvars-file "~/.config/doom/pantheon.envvar"))
#+end_src

** Identity
Used by templates, snippets, GPG/email tooling, and some package defaults. I default to my personal email, with a per-machine override for my work laptop.

*** Personal Machines.
#+begin_src emacs-lisp
(setq user-full-name "Masood Ahmed"
      user-mail-address "me@ahmedmasood.com")
#+end_src

*** Work Machine.
On my work laptop, set the correct email.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (setq user-mail-address "masoodahmed@pantheon.io"))
#+end_src

* Editing defaults
** Language-aware soft wrapping
Global “smart” wrapping is useful for prose and code comments while keeping indentation reasonable.

#+begin_src emacs-lisp
(+global-word-wrap-mode t)
#+end_src

* Projects
Projectile is my project indexer. I keep my working directories under =~/code=.

#+begin_src emacs-lisp
(setq projectile-project-search-path '("~/code/"))
#+end_src

* Org mode
** Org directory
Org needs =org-directory= set before Org loads so capture, agenda, etc. use the right paths.

#+begin_src emacs-lisp
(setq org-directory "~/org/")
#+end_src

** Tables and TODO highlighting
These are quality-of-life preferences for Org buffers.

#+begin_src emacs-lisp
(setq org-modern-table-vertical 1
      org-modern-table t)
#+end_src

TODO Highlighting

#+begin_src emacs-lisp
(add-hook 'org-mode-hook #'hl-todo-mode)
#+end_src

* Look and feel
** Font
The primary font used for the UI and editing. If the font isn’t found, confirm it’s installed and use =M-x describe-font=.

#+begin_src emacs-lisp
(setq doom-font (font-spec :family "MesloLGS Nerd Font" :size 14))
#+end_src

** Theme
Doom themes are set via =doom-theme=. Theme changes are applied on restart or with =M-x doom/reload-theme=.

#+begin_src emacs-lisp
(setq doom-theme 'catppuccin)
#+end_src

** Line numbers
This determines the style of line numbers in effect. If set to =nil=, line numbers are disabled. For relative line numbers, set this to =relative=. Relative line numbers work well with Evil motions.

#+begin_src emacs-lisp
(setq display-line-numbers-type 'relative)
#+end_src

** Org heading typography
I like larger headings in Org buffers for readability. This config is intentionally applied *after* theme load *and* org mode is loaded so it works regardless of which theme is active.

#+begin_src emacs-lisp
(after! org
  (custom-theme-set-faces!
    '(org-level-8 :inherit outline-3 :height 1.0)
    '(org-level-7 :inherit outline-3 :height 1.0)
    '(org-level-6 :inherit outline-3 :height 1.1)
    '(org-level-5 :inherit outline-3 :height 1.2)
    '(org-level-4 :inherit outline-3 :height 1.3)
    '(org-level-3 :inherit outline-3 :height 1.4)
    '(org-level-2 :inherit outline-2 :height 1.5)
    '(org-level-1 :inherit outline-1 :height 1.6)
    '(org-document-title :height 1.8 :bold t :underline nil)))
#+end_src

* AI and developer integrations
** GPTel + Magit
Integrates GPTel with Forge pull request workflows.

*** Magit

#+begin_src emacs-lisp
(use-package! gptel-magit
  :after magit
  :hook (magit-mode . gptel-magit-install))
#+end_src

*** Forge

#+begin_src emacs-lisp
(use-package! gptel-forge-prs
  :after forge
  :config
  (gptel-forge-prs-install))
#+end_src

* Apps
** Slack (For work)
Slack is only configured on my Pantheon laptop. Credentials are pulled from auth-source entries keyed by host/user.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))
  (use-package! slack
    :config
    (slack-register-team
     :name "pantheon"
     :token (auth-source-pick-first-password
             :host "pantheon.slack.com"
             :user "masoodahmed@pantheon.io^token")
     :enterprise-token (auth-source-pick-first-password
                        :host "pantheon.slack.com"
                        :user "masoodahmed@pantheon.io^enterprise-token")
     :cookie (auth-source-pick-first-password
              :host "pantheon.slack.com"
              :user "masoodahmed@pantheon.io^cookie")
     :full-and-display-names t
     :default t
     :subscribed-channels nil)))
#+end_src

** Alert (For work)
I use alert package for Slack alerts.

#+begin_src emacs-lisp
(when (file-regular-p (expand-file-name "~/.work-pantheon"))

  (use-package! alert
    :commands (alert)
    :init
    (setq alert-default-style 'notifier)))
#+end_src

* Exit behavior
I prefer to exit without confirmation prompts.

#+begin_src emacs-lisp
(setq confirm-kill-emacs nil)
(setq confirm-kill-processes nil)
#+end_src
